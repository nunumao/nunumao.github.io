<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>编程日记</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
  
<link rel="stylesheet" href="/css/github-markdown.css">

  
<link rel="stylesheet" href="/css/atom-one-dark.css">

  <script src="https://cdn.tailwindcss.com"></script>
  
<script src="/js/jquery.min.js"></script>

  
<script src="/js/script.js"></script>

<meta name="generator" content="Hexo 7.3.0"></head>

<body class="bg-gray-50 text-gray-800">
  <div class="lg:hidden fixed right-4 top-4 z-50">
    <button class="p-2 bg-white/80 backdrop-blur-sm rounded-lg border" data-mobile-menu-trigger><i class="fas fa-bars"></i></button>
  </div>
  <!-- 导航栏 -->
  <nav class="border-b bg-white/80 backdrop-blur-sm sticky top-0 z-40">
    <div class="max-w-5xl mx-auto px-4">
      <div class="flex justify-between items-center h-16">
        <a href="/" class="text-xl font-serif">编程日记</a>
        <!-- 桌面端导航 -->
        <div class="hidden lg:flex items-center space-x-6">
          <div class="flex items-center space-x-6 text-sm">
            <a href="/" class="hover:text-blue-600" data-i18n="nav.home">首页</a>
            <!-- 分类下拉菜单 -->
            <div class="relative group">
              <a href="/categories" class="hover:text-blue-600">分类</a>
              <!-- 优化后的下拉内容 -->
              <div class="absolute left-0 mt-2 py-2 bg-white backdrop-blur-sm border rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                <div class="grid grid-cols-2 gap-1 w-[400px] p-4">
                  
                    
                      
                        <a class="flex items-center space-x-2 p-2 rounded-lg hover:bg-blue-50" href="/categories/服务器/">
                          <i class="fas fa-code text-blue-500"></i>
                          <span>服务器</span>
                        </a>
                      
                    
                      
                        <a class="flex items-center space-x-2 p-2 rounded-lg hover:bg-blue-50" href="/categories/后端技术/">
                          <i class="fas fa-code text-blue-500"></i>
                          <span>后端技术</span>
                        </a>
                      
                    
                      
                    
                      
                        <a class="flex items-center space-x-2 p-2 rounded-lg hover:bg-blue-50" href="/categories/前端技术/">
                          <i class="fas fa-code text-blue-500"></i>
                          <span>前端技术</span>
                        </a>
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                  
                </div>
              </div>
            </div>
            <a href="/case" class="hover:text-blue-600" data-i18n="nav.case">作品</a>
            <a href="/archives" class="hover:text-blue-600" data-i18n="nav.archives">归档</a>
            <a href="/about" class="hover:text-blue-600" data-i18n="nav.about">关于</a>
            <!-- 搜索框 -->
            <div class="relative">
              <input type="search" placeholder="Search articles..." class="w-48 px-4 py-1 text-sm border rounded-full bg-gray-50 focus:outline-none focus:ring-1 focus:ring-blue-500">
              <i class="fas fa-search absolute right-3 top-2 text-gray-400"></i>
            </div>
            <!-- 语言切换 -->
            <div class="flex items-center space-x-2 ml-4 text-sm border-l pl-4">
              <button class="lang-switch hover:text-blue-600" @click="changeLang('en-US')">EN</button>
              <span class="text-gray-300">|</span>
              <button class="lang-switch hover:text-blue-600" @click="changeLang('zh-CN')">简</button>
              <span class="text-gray-300">|</span>
              <button class="lang-switch hover:text-blue-600" @click="changeLang('zh-TW')">繁</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
  <div id="mobileMenu" class="fixed inset-0 bg-white/90 backdrop-blur-sm z-40 lg:hidden hidden">
    <div class="h-full w-full flex flex-col items-center justify-center space-y-6 text-lg">
      <a href="/" class="hover:text-blue-600" data-i18n="nav.home">首页</a>
      <a href="/categories" class="hover:text-blue-600" data-i18n="nav.categories">分类</a>
      <a href="/case" class="hover:text-blue-600" data-i18n="nav.case">作品</a>
      <a href="/archives" class="hover:text-blue-600" data-i18n="nav.archive">归档</a>
      <a href="/about" class="hover:text-blue-600" data-i18n="nav.about">关于</a>
      <div class="flex items-center space-x-4 mt-4">
        <button class="lang-switch hover:text-blue-600" data-lang="en">EN</button>
        <button class="lang-switch hover:text-blue-600" data-lang="zh">简</button>
        <button class="lang-switch hover:text-blue-600" data-lang="zh-TW">繁</button>
      </div>
    </div>
  </div>
  <main class="max-w-5xl mx-auto px-4 py-12">
  <div class="lg:flex lg:gap-8">
    <!-- 文章主体 -->
    <article class="lg:w-3/4">
      <!-- 文章容器 -->
      <div class="bg-white rounded-xl overflow-hidden">
        <!-- 文章头部 -->
        <div class="px-8 pt-12 pb-8">
          <!-- 标题 -->
          <h1 class="text-3xl font-medium mb-6 leading-snug">
            Kotlin (八) | 空安全
          </h1>

          <!-- 元信息 -->
          <div class="flex flex-wrap items-center gap-6 text-sm text-gray-500">
            <span>
              <i class="fas fa-folder-open mr-2"></i>
              
                <a href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/KOTLIN/" class="hover:text-blue-600">
                  KOTLIN
                </a>
                
            </span>
            <span>
              <i class="far fa-calendar mr-2"></i>
              2025-02-10
            </span>
            <span><i class="far fa-clock mr-2"></i>15 分钟阅读</span>
            <span><i class="far fa-eye mr-2"></i>
              0
            </span>
          </div>
        </div>

        <!-- 文章内容 -->
        <div class="px-8 py-10 border-t border-b">
          <div class="markdown-body">
            <p><strong>空安全 (Null Safety)</strong></p>
<p>空指针异常 (NullPointerException, NPE) 是 Java 和许多其他编程语言中常见的错误，也是程序崩溃的主要原因之一。 Kotlin 致力于消除 NPE 的风险，通过其强大的空安全机制，在编译时就能检测出潜在的空指针问题，从而提高程序的健壮性和可靠性。</p>
<p><strong>可空类型 (Nullable Types) 和不可空类型 (Non-nullable Types)</strong></p>
<p>Kotlin 的类型系统区分可空类型和不可空类型。</p>
<ul>
<li><p><strong>不可空类型 (Non-nullable Types):</strong>  默认情况下，Kotlin 中的变量声明为不可空类型。  这意味着变量不能赋值为 <code>null</code>。  如果你尝试将 <code>null</code> 赋值给不可空类型的变量，编译器会报错。</p>
  <figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: String = <span class="string">&quot;Alice&quot;</span> <span class="comment">// String 类型默认是不可空的</span></span><br><span class="line">    <span class="comment">// name = null       // 编译错误：Null can not be a value of a non-null type String</span></span><br><span class="line"></span><br><span class="line">    println(name.length) <span class="comment">// 可以安全地访问 name 的属性和方法，因为 name 保证不为 null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>可空类型 (Nullable Types):</strong>  如果一个变量可能为 <code>null</code>，你需要显式地声明它为可空类型。  可空类型在类型名称后面加上问号 <code>?</code>。  例如，<code>String?</code> 表示一个可以为 <code>null</code> 的字符串类型。</p>
  <figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> nullableName: String? = <span class="string">&quot;Bob&quot;</span> <span class="comment">// String? 类型是可空的</span></span><br><span class="line">    nullableName = <span class="literal">null</span>              <span class="comment">// 正确，nullableName 可以赋值为 null</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// println(nullableName.length) // 编译错误：Variable &#x27;nullableName&#x27; can be null.</span></span><br><span class="line">                                     <span class="comment">// You must handle the nullable case explicitly.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>为什么区分可空和不可空类型？</strong></p>
<p>Kotlin 的这种区分在类型系统层面强制开发者处理空值情况。  对于不可空类型，编译器保证在运行时不会出现 NPE，因为变量不可能为 <code>null</code>。  对于可空类型，编译器会强制开发者在使用可空变量之前进行空值检查，以避免 NPE。 这大大提高了代码的安全性。</p>
<p><strong>安全调用运算符 <code>?.</code> (Safe Call Operator)</strong></p>
<p>安全调用运算符 <code>?.</code> 允许你安全地访问可空对象的属性或方法。  如果对象为 <code>null</code>，则整个表达式的结果为 <code>null</code>，而不会抛出 NPE。</p>
<p><strong>语法:</strong></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">可空对象?.属性名</span><br><span class="line">可空对象?.方法名()</span><br></pre></td></tr></table></figure>

<p><strong>例子：</strong></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> nullableString: String? = <span class="string">&quot;Hello&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用安全调用运算符 ?. 访问 length 属性</span></span><br><span class="line">    <span class="keyword">val</span> length1 = nullableString?.length <span class="comment">// 如果 nullableString 不为 null，返回 length，否则返回 null</span></span><br><span class="line">    println(<span class="string">&quot;Length 1: <span class="variable">$length1</span>&quot;</span>) <span class="comment">// 输出: Length 1: 5</span></span><br><span class="line"></span><br><span class="line">    nullableString = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">val</span> length2 = nullableString?.length <span class="comment">// nullableString 为 null，返回 null</span></span><br><span class="line">    println(<span class="string">&quot;Length 2: <span class="variable">$length2</span>&quot;</span>) <span class="comment">// 输出: Length 2: null</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 链式安全调用</span></span><br><span class="line">    <span class="keyword">val</span> address: Address? = <span class="literal">null</span> <span class="comment">// 假设 Address 类有 city 属性，City 类有 name 属性</span></span><br><span class="line">    <span class="comment">// val cityName = address?.city?.name // 如果 address 或 city 为 null，cityName 结果为 null，不会抛出 NPE</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">Address</span>(<span class="keyword">val</span> city: City?)</span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">City</span>(<span class="keyword">val</span> name: String)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> address1 = Address(City(<span class="string">&quot;北京&quot;</span>))</span><br><span class="line">    <span class="keyword">val</span> address2 = Address(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">val</span> person1 = Person(<span class="string">&quot;张三&quot;</span>, address1)</span><br><span class="line">    <span class="keyword">val</span> person2 = Person(<span class="string">&quot;李四&quot;</span>, address2)</span><br><span class="line">    <span class="keyword">val</span> person3 = Person(<span class="string">&quot;王五&quot;</span>, <span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getCityName</span><span class="params">(person: <span class="type">Person</span>?)</span></span>: String? &#123;</span><br><span class="line">        <span class="keyword">return</span> person?.address?.city?.name <span class="comment">// 安全调用链，任何环节为 null 都返回 null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;Person1&#x27;s city: <span class="subst">$&#123;getCityName(person1)&#125;</span>&quot;</span>) <span class="comment">// 输出: Person1&#x27;s city: 北京</span></span><br><span class="line">    println(<span class="string">&quot;Person2&#x27;s city: <span class="subst">$&#123;getCityName(person2)&#125;</span>&quot;</span>) <span class="comment">// 输出: Person2&#x27;s city: null (address.city 为 null)</span></span><br><span class="line">    println(<span class="string">&quot;Person3&#x27;s city: <span class="subst">$&#123;getCityName(person3)&#125;</span>&quot;</span>) <span class="comment">// 输出: Person3&#x27;s city: null (person.address 为 null)</span></span><br><span class="line">    println(<span class="string">&quot;Null person&#x27;s city: <span class="subst">$&#123;getCityName(null)&#125;</span>&quot;</span>) <span class="comment">// 输出: Null person&#x27;s city: null (person 为 null)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">Person</span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> address: Address?)</span><br></pre></td></tr></table></figure>

<p><strong>安全调用运算符 <code>?.</code> 是处理可空类型最常用的方式，可以避免 NPE，并使代码更简洁。</strong></p>
<p><strong>Elvis 运算符 <code>?:</code></strong></p>
<p>Elvis 运算符 <code>?:</code> (也称为 null-coalescing operator) 用于在可空表达式为 <code>null</code> 时提供一个默认值。  如果 <code>?:</code> 左边的表达式不为 <code>null</code>，则返回左边的表达式的值；如果左边的表达式为 <code>null</code>，则返回 <code>?:</code> 右边的表达式的值 (默认值)。</p>
<p><strong>语法:</strong></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">可空表达式 ?: 默认值</span><br></pre></td></tr></table></figure>

<p><strong>例子：</strong></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> nullableString: String? = <span class="string">&quot;Hello&quot;</span></span><br><span class="line">    <span class="keyword">val</span> nameLength1 = nullableString?.length ?: <span class="number">0</span> <span class="comment">// 如果 nullableString?.length 为 null，则返回 0，否则返回 length</span></span><br><span class="line">    println(<span class="string">&quot;Length 1: <span class="variable">$nameLength1</span>&quot;</span>) <span class="comment">// 输出: Length 1: 5</span></span><br><span class="line"></span><br><span class="line">    nullableString = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">val</span> nameLength2 = nullableString?.length ?: <span class="number">0</span> <span class="comment">// nullableString?.length 为 null，返回默认值 0</span></span><br><span class="line">    println(<span class="string">&quot;Length 2: <span class="variable">$nameLength2</span>&quot;</span>) <span class="comment">// 输出: Length 2: 0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getGreeting</span><span class="params">(name: <span class="type">String</span>?)</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, <span class="subst">$&#123;name ?: <span class="string">&quot;Guest&quot;</span>&#125;</span>&quot;</span> <span class="comment">// 如果 name 为 null，则使用默认值 &quot;Guest&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(getGreeting(<span class="string">&quot;Alice&quot;</span>)) <span class="comment">// 输出: Hello, Alice</span></span><br><span class="line">    println(getGreeting(<span class="literal">null</span>))    <span class="comment">// 输出: Hello, Guest</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Elvis 运算符 <code>?:</code>  常与安全调用运算符 <code>?.</code> 结合使用，为可空值提供默认值，使代码更简洁。</strong></p>
<p><strong>非空断言运算符 <code>!!</code> (Not-null Assertion Operator)</strong></p>
<p>非空断言运算符 <code>!!</code> 用于显式地断言一个可空变量不为 <code>null</code>。  如果你确定一个可空变量在某个时刻一定不为 <code>null</code>，可以使用 <code>!!</code> 运算符。  <strong>但是，如果实际上变量为 <code>null</code>，使用 <code>!!</code> 运算符将会抛出 NPE。</strong></p>
<p><strong>语法:</strong></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">可空对象!!</span><br></pre></td></tr></table></figure>

<p><strong>例子：</strong></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> nullableString: String? = <span class="string">&quot;World&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用非空断言运算符 !!</span></span><br><span class="line">    <span class="keyword">val</span> length1 = nullableString!!.length <span class="comment">// 断言 nullableString 不为 null，获取 length</span></span><br><span class="line">    println(<span class="string">&quot;Length 1: <span class="variable">$length1</span>&quot;</span>) <span class="comment">// 输出: Length 1: 5</span></span><br><span class="line"></span><br><span class="line">    nullableString = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// val length2 = nullableString!!.length // 运行时错误：NullPointerException!! nullableString 为 null，抛出 NPE</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 避免过度使用 !!，除非你非常确定变量不为 null，否则容易导致 NPE</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>非空断言运算符 <code>!!</code> 应该谨慎使用，因为它会使 Kotlin 的空安全机制失效，可能导致 NPE。  通常应该优先使用安全调用运算符 <code>?.</code> 和 Elvis 运算符 <code>?:</code> 等更安全的方式来处理可空类型。  <code>!!</code> 运算符主要用于一些特殊情况，例如在测试代码中，或者在与 Java 代码互操作时，你非常确定某个 Java 方法不会返回 <code>null</code>。</strong></p>
<p><strong><code>let</code>, <code>run</code>, <code>with</code>, <code>apply</code>, <code>also</code> 函数 - 初步介绍</strong></p>
<p>Kotlin 标准库提供了一组作用域函数 (scope functions)： <code>let</code>, <code>run</code>, <code>with</code>, <code>apply</code>, <code>also</code>。  这些函数可以更简洁、更优雅地处理可空类型和对象初始化等场景。  我们这里先初步介绍它们在空安全中的应用，更详细的用法将在后续章节学习。</p>
<ul>
<li><p><strong><code>let</code> 函数:</strong>  常用于对可空对象执行操作，只有当对象不为 <code>null</code> 时才执行 Lambda 表达式。  Lambda 表达式的参数是对象本身 (使用 <code>it</code> 关键字或自定义参数名)。  <code>let</code> 函数的返回值是 Lambda 表达式的返回值。</p>
  <figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> nullableString: String? = <span class="string">&quot;Kotlin&quot;</span></span><br><span class="line"></span><br><span class="line">    nullableString?.let &#123; str -&gt; <span class="comment">// 只有 nullableString 不为 null 时才执行 let 代码块</span></span><br><span class="line">        println(<span class="string">&quot;String length: <span class="subst">$&#123;str.length&#125;</span>&quot;</span>) <span class="comment">// 在 let 代码块中，str 保证不为 null</span></span><br><span class="line">        <span class="comment">// 可以执行其他操作</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    nullableString = <span class="literal">null</span></span><br><span class="line">    nullableString?.let &#123; str -&gt; <span class="comment">// nullableString 为 null，let 代码块不会执行</span></span><br><span class="line">        println(<span class="string">&quot;This will not be printed&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>run</code> 函数:</strong>  与 <code>let</code> 类似，也常用于对可空对象执行操作，只有当对象不为 <code>null</code> 时才执行 Lambda 表达式。  区别在于，<code>run</code> 函数的 Lambda 表达式中使用 <code>this</code> 关键字来引用对象，而不是 <code>it</code>。  <code>run</code> 函数的返回值也是 Lambda 表达式的返回值。  <code>run</code> 函数也可以不作用于可空对象，直接执行一段代码块。</p>
  <figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> nullableString: String? = <span class="string">&quot;Kotlin&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> length = nullableString?.run &#123; <span class="comment">// 只有 nullableString 不为 null 时才执行 run 代码块</span></span><br><span class="line">        println(<span class="string">&quot;String in run: <span class="variable">$this</span>&quot;</span>) <span class="comment">// 在 run 代码块中，this 指向 nullableString (非 null)</span></span><br><span class="line">        <span class="keyword">this</span>.length <span class="comment">// run 代码块的最后一个表达式作为返回值</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;Length: <span class="variable">$length</span>&quot;</span>) <span class="comment">// 输出 Length: 6</span></span><br><span class="line"></span><br><span class="line">    nullableString = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">val</span> length2 = nullableString?.run &#123; <span class="comment">// nullableString 为 null，run 代码块不会执行，返回 null</span></span><br><span class="line">        <span class="keyword">this</span>.length <span class="comment">// 不会执行</span></span><br><span class="line">    &#125; ?: -<span class="number">1</span> <span class="comment">// 使用 Elvis 运算符提供默认值 -1，当 nullableString 为 null 时</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;Length 2: <span class="variable">$length2</span>&quot;</span>) <span class="comment">// 输出: Length 2: -1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// run 函数也可以直接执行代码块</span></span><br><span class="line">    <span class="keyword">val</span> result = run &#123;</span><br><span class="line">        <span class="keyword">val</span> a = <span class="number">10</span></span><br><span class="line">        <span class="keyword">val</span> b = <span class="number">20</span></span><br><span class="line">        a + b <span class="comment">// run 代码块的最后一个表达式作为返回值</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;Run block result: <span class="variable">$result</span>&quot;</span>) <span class="comment">// 输出: Run block result: 30</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>with</code> 函数:</strong>  用于对一个对象执行多个操作，可以避免重复写对象名。  <code>with</code> 函数不是安全调用，如果对象为 <code>null</code>，会抛出 NPE。  通常用于对非空对象进行操作。  <code>with</code> 函数的返回值是 Lambda 表达式的返回值。</p>
  <figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">Configuration</span>(<span class="keyword">var</span> host: String?, <span class="keyword">var</span> port: <span class="built_in">Int</span>?)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> config = Configuration(<span class="string">&quot;localhost&quot;</span>, <span class="number">8080</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> serverAddress = with(config) &#123; <span class="comment">// with 函数，对 config 对象执行操作</span></span><br><span class="line">        <span class="string">&quot;<span class="variable">$host</span>:<span class="variable">$port</span>&quot;</span> <span class="comment">// 在 Lambda 表达式中可以直接访问 config 对象的属性 (使用 this 或省略 this)</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;Server address: <span class="variable">$serverAddress</span>&quot;</span>) <span class="comment">// 输出: Server address: localhost:8080</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> nullableConfig: Configuration? = Configuration(<span class="string">&quot;localhost&quot;</span>, <span class="literal">null</span>) <span class="comment">// port 为 null</span></span><br><span class="line">    <span class="comment">// val serverAddress2 = with(nullableConfig) &#123; // 错误！with 函数不适用于可空对象，nullableConfig 可能为 null</span></span><br><span class="line">    <span class="comment">//     &quot;$host:$port&quot; // 可能 NPE，因为 port 可能为 null</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> serverAddress3 = nullableConfig?.let &#123; config -&gt; <span class="comment">// 使用 let 函数安全处理可空 config</span></span><br><span class="line">        with(config) &#123; <span class="comment">// 在 let 代码块中，config 保证不为 null，可以使用 with 函数</span></span><br><span class="line">            <span class="string">&quot;<span class="variable">$host</span>:<span class="variable">$port</span>&quot;</span> <span class="comment">// 但 host 和 port 仍然可能是可空的，需要安全处理</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; ?: <span class="string">&quot;Invalid Address&quot;</span> <span class="comment">// 如果 nullableConfig 为 null，返回默认值</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;Server address 3: <span class="variable">$serverAddress3</span>&quot;</span>) <span class="comment">// 输出: Server address 3: localhost:null， port 为 null 导致输出 null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> serverAddress4 = nullableConfig?.let &#123; config -&gt;</span><br><span class="line">        with(config) &#123;</span><br><span class="line">            <span class="string">&quot;<span class="subst">$&#123;host ?: <span class="string">&quot;unknown&quot;</span>&#125;</span>:<span class="subst">$&#123;port ?: <span class="number">-1</span>&#125;</span>&quot;</span> <span class="comment">// 使用 Elvis 运算符为 host 和 port 提供默认值</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; ?: <span class="string">&quot;Invalid Address&quot;</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;Server address 4: <span class="variable">$serverAddress4</span>&quot;</span>) <span class="comment">// 输出: Server address 4: localhost:-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>apply</code> 函数:</strong>  用于配置对象自身，并返回对象自身。  Lambda 表达式中可以使用 <code>this</code> 关键字引用对象。  <code>apply</code> 函数常用于对象初始化时进行配置。</p>
  <figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">Email</span>(<span class="keyword">var</span> to: String? = <span class="literal">null</span>, <span class="keyword">var</span> subject: String? = <span class="literal">null</span>, <span class="keyword">var</span> body: String? = <span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> email = Email().apply &#123; <span class="comment">// 使用 apply 函数配置 Email 对象</span></span><br><span class="line">        to = <span class="string">&quot;user@example.com&quot;</span></span><br><span class="line">        subject = <span class="string">&quot;Hello&quot;</span></span><br><span class="line">        body = <span class="string">&quot;This is an email body.&quot;</span></span><br><span class="line">    &#125; <span class="comment">// apply 函数返回 email 对象自身</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;Email to: <span class="subst">$&#123;email.to&#125;</span>, subject: <span class="subst">$&#123;email.subject&#125;</span>, body: <span class="subst">$&#123;email.body&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment">// 输出: Email to: user@example.com, subject: Hello, subject: This is an email body.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>also</code> 函数:</strong>  用于执行一些额外的操作，例如打印日志、发送通知等，但不会改变对象自身。  Lambda 表达式的参数是对象本身 (使用 <code>it</code> 关键字或自定义参数名)。  <code>also</code> 函数返回对象自身。</p>
  <figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> numbers = mutableListOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    numbers.filter &#123; it &gt; <span class="number">3</span> &#125;</span><br><span class="line">        .also &#123; println(<span class="string">&quot;Filtered numbers: <span class="variable">$it</span>&quot;</span>) &#125; <span class="comment">// 使用 also 函数打印过滤后的结果，但不改变 numbers 列表</span></span><br><span class="line">        .map &#123; it * <span class="number">2</span> &#125;</span><br><span class="line">        .also &#123; println(<span class="string">&quot;Mapped numbers: <span class="variable">$it</span>&quot;</span>) &#125; <span class="comment">// 再次使用 also 打印映射后的结果</span></span><br><span class="line">        <span class="comment">// ... 其他操作</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;Original numbers: <span class="variable">$numbers</span>&quot;</span>) <span class="comment">// 输出: Original numbers: [1, 2, 3, 4, 5] - numbers 列表没有被修改</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><code>let</code>, <code>run</code>, <code>with</code>, <code>apply</code>, <code>also</code> 这五个作用域函数在不同场景下有不同的用途，它们可以使 Kotlin 代码更加简洁、易读、富有表达力。  在处理空安全和对象操作时，它们是非常有用的工具。  我们会在后续章节更深入地学习这些函数。</p>

          </div>
        </div>

        <!-- 文章底部 -->
        <div class="px-8 py-8">
          <!-- 标签 -->
          
            <div class="flex flex-wrap gap-2 mb-8">
              
                <a href="/tags/KOTLIN/" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-600 transition-colors">
                  KOTLIN
                </a>
                
            </div>
            

              <!-- 分享 -->
              <div class="flex items-center justify-between mb-8 py-6 border-t border-b">
                <div class="text-sm text-gray-500">分享文章：</div>
                <div class="flex gap-4">
                  <button class="text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="far fa-copy text-xl"></i>
                  </button>
                </div>
              </div>

              <!-- 上一篇/下一篇 -->
              <div class="flex flex-col sm:flex-row justify-between gap-4">
                
                  <a href="/cm6z6k8kg0001tcx51mpl4qpj.html" class="group flex-1">
                    <div class="text-sm text-gray-500 mb-1">上一篇</div>
                    <div class="group-hover:text-blue-600 transition-colors">
                      Kotlin (九) | 扩展函数和扩展属性
                    </div>
                  </a>
                  
                    
                      <a href="/cm6z6k8ki0005tcx5g1pl9erv.html" class="group flex-1 text-right">
                        <div class="text-sm text-gray-500 mb-1">下一篇</div>
                        <div class="group-hover:text-blue-600 transition-colors">
                          Kotlin (六) | 接口
                        </div>
                      </a>
                      
              </div>
        </div>
      </div>
    </article>

    <!-- 侧边栏 -->
    <aside class="lg:w-1/4 mt-8 lg:mt-0 space-y-6">
      <!-- 作者信息 -->
      <div class="bg-white rounded-xl p-6">
        <div class="flex items-center gap-4 mb-4">
          <img src="/images/avatar.jpg" class="w-16 h-16 rounded-full">
          <div>
            <h3 class="font-medium">Nunumao</h3>
            <p class="text-sm text-gray-500">开发工程师</p>
          </div>
        </div>
        <p class="text-sm text-gray-600 mb-4">专注于技术研究，热爱分享技术心得</p>
        <div class="flex justify-center gap-4">
          <a href="https://github.com/nunumao" target="_blank" class="text-gray-400 hover:text-gray-600">
            <i class="fab fa-github text-xl"></i>
          </a>
          <a href="mailto:gm292018748@email.com" target="_blank" class="text-gray-400 hover:text-[#1DA1F2]">
            <i class="fas fa-envelope text-xl"></i>
          </a>
        </div>
      </div>

      <!-- 目录 -->
      <div class="bg-white rounded-xl p-6 sticky top-24">
        <h2 class="text-lg font-medium mb-4">目录</h2>
        <nav class="space-y-2 text-sm">
          
        </nav>
      </div>

      <!-- 分类列表 -->
      <div class="bg-white rounded-xl p-6">
        <h2 class="text-lg font-medium mb-4">文章分类</h2>
        <div class="space-y-3">
          
            <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="flex items-center justify-between group">
              <div class="flex items-center">
                <i class="fas fa-folder text-gray-500 w-5"></i>
                <span class="text-sm group-hover:text-blue-600">
                  服务器
                </span>
              </div>
              <span class="text-xs text-gray-500">
                3
              </span>
            </a>
            
            <a href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/" class="flex items-center justify-between group">
              <div class="flex items-center">
                <i class="fas fa-server text-green-500 w-5"></i>
                <span class="text-sm group-hover:text-blue-600">
                  后端技术
                </span>
              </div>
              <span class="text-xs text-gray-500">
                20
              </span>
            </a>
            
            <a href="/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/" class="flex items-center justify-between group">
              <div class="flex items-center">
                <i class="fas fa-code text-blue-500 w-5"></i>
                <span class="text-sm group-hover:text-blue-600">
                  前端技术
                </span>
              </div>
              <span class="text-xs text-gray-500">
                1
              </span>
            </a>
            
        </div>
      </div>

      <!-- 相关文章 -->
      <div class="bg-white rounded-xl p-6">
        <h2 class="text-lg font-medium mb-4">相关文章</h2>
        <div class="space-y-4">
          
            <a href="/cm6z562wp0000ysx5fx4xfxyq.html" class="block group">
              <h3 class="text-sm font-medium group-hover:text-blue-600 line-clamp-2">
                Kotlin (一) | 基本语法
              </h3>
              <p class="text-xs text-gray-500 mt-1">2025-02-10</p>
            </a>
            
            <a href="/cm6z562wt0001ysx5g3tn4b0o.html" class="block group">
              <h3 class="text-sm font-medium group-hover:text-blue-600 line-clamp-2">
                Kotlin (四) | 类和对象
              </h3>
              <p class="text-xs text-gray-500 mt-1">2025-02-10</p>
            </a>
            
            <a href="/cm6z562wx0003ysx5e2pn7bg7.html" class="block group">
              <h3 class="text-sm font-medium group-hover:text-blue-600 line-clamp-2">
                Kotlin (二) | 控制流
              </h3>
              <p class="text-xs text-gray-500 mt-1">2025-02-10</p>
            </a>
            
            <a href="/cm6z562wy0005ysx551of5kin.html" class="block group">
              <h3 class="text-sm font-medium group-hover:text-blue-600 line-clamp-2">
                Kotlin (三) | 函数
              </h3>
              <p class="text-xs text-gray-500 mt-1">2025-02-10</p>
            </a>
            
            <a href="/cm6z6k8kb0000tcx56eq63qfa.html" class="block group">
              <h3 class="text-sm font-medium group-hover:text-blue-600 line-clamp-2">
                Kotlin (七) | 集合
              </h3>
              <p class="text-xs text-gray-500 mt-1">2025-02-10</p>
            </a>
            
        </div>
      </div>
    </aside>
  </div>
</main>

<style>
  .markdown-body {
    box-sizing: border-box;
    min-width: 200px;
    max-width: 100%;
    margin: 0 auto;
    background-color: white;
  }

  /* 适配深色模式 */
  @media (prefers-color-scheme: dark) {
    .markdown-body {
      color-scheme: dark;
      --color-prettylights-syntax-comment: #8b949e;
      --color-prettylights-syntax-constant: #79c0ff;
      --color-prettylights-syntax-entity: #d2a8ff;
      --color-prettylights-syntax-storage-modifier-import: #c9d1d9;
      --color-prettylights-syntax-entity-tag: #7ee787;
      --color-prettylights-syntax-keyword: #ff7b72;
      --color-prettylights-syntax-string: #a5d6ff;
      --color-prettylights-syntax-variable: #ffa657;
      --color-prettylights-syntax-brackethighlighter-unmatched: #f85149;
      --color-prettylights-syntax-invalid-illegal-text: #f0f6fc;
      --color-prettylights-syntax-invalid-illegal-bg: #8e1519;
      --color-prettylights-syntax-carriage-return-text: #f0f6fc;
      --color-prettylights-syntax-carriage-return-bg: #b62324;
      --color-prettylights-syntax-string-regexp: #7ee787;
      --color-prettylights-syntax-markup-list: #f2cc60;
      --color-prettylights-syntax-markup-heading: #1f6feb;
      --color-prettylights-syntax-markup-italic: #c9d1d9;
      --color-prettylights-syntax-markup-bold: #c9d1d9;
      --color-prettylights-syntax-markup-deleted-text: #ffdcd7;
      --color-prettylights-syntax-markup-deleted-bg: #67060c;
      --color-prettylights-syntax-markup-inserted-text: #aff5b4;
      --color-prettylights-syntax-markup-inserted-bg: #033a16;
      --color-prettylights-syntax-markup-changed-text: #ffdfb6;
      --color-prettylights-syntax-markup-changed-bg: #5a1e02;
      --color-prettylights-syntax-markup-ignored-text: #c9d1d9;
      --color-prettylights-syntax-markup-ignored-bg: #1158c7;
      --color-prettylights-syntax-meta-diff-range: #d2a8ff;
      --color-prettylights-syntax-brackethighlighter-angle: #8b949e;
      --color-prettylights-syntax-sublimelinter-gutter-mark: #484f58;
      --color-prettylights-syntax-constant-other-reference-link: #a5d6ff;
      --color-fg-default: #c9d1d9;
      --color-fg-muted: #8b949e;
      --color-fg-subtle: #6e7681;
      --color-canvas-default: #0d1117;
      --color-canvas-subtle: #161b22;
      --color-border-default: #30363d;
      --color-border-muted: #21262d;
      --color-neutral-muted: rgba(110, 118, 129, 0.4);
      --color-accent-fg: #58a6ff;
      --color-accent-emphasis: #1f6feb;
      --color-attention-subtle: rgba(187, 128, 9, 0.15);
      --color-danger-fg: #f85149;
    }
  }
</style>
  <!-- 页脚 -->
<footer class="border-t mt-16">
  <div class="max-w-4xl mx-auto px-4 py-8 text-center text-sm text-gray-500">
    <p>© 2025 nunumao. Built with <a href="#" class="text-blue-600">Hexo</a></p>
  </div>
</footer>
</body>

</html>